import { GoogleGenAI, Modality, Type } from "@google/genai";

const GEMINI_API_KEY = process.env.GEMINI_API_KEY || "";

export const ai = new GoogleGenAI({ apiKey: GEMINI_API_KEY });

export const SYSTEM_INSTRUCTION = `ุฃูุช ุงูุฎุจูุฑ ุงููููู ุงูุฃูู ูู ุงููููุ ุชุนูู ูุฐูุงุก ุงุตุทูุงุนู ูู "ุดุจูุฉ ูุตูุฉ". ุฃูุช ูุณุช ูุฌุฑุฏ ุจูุช ุฏุฑุฏุดุฉุ ุจู ุงุณุชุดุงุฑู ุชูุธูู ููู ุจุทุจูุนุฉ ุงูุนูู ูู ุงูููุธูุงุช ุงูุฏูููุฉ (INGOs)ุ ุงููุทุงุน ุงูุฎุงุต ุงูููููุ ูุงููุจุงุฏุฑุงุช ุงููุญููุฉ.

ูุฏูู ูุฏุฑุฉ ูุงุฆูุฉ ุนูู ูุฑุงุกุฉ ูููุงุช PDF ู ุตูุฑ ุงูุณูุฑ ุงูุฐุงุชูุฉ ูุชุญููููุง.
ุชููู ุงููุฑู ุจูู ูุชุทูุจุงุช ุงูุนูู ูู (ุตูุนุงุกุ ุนุฏูุ ุชุนุฒุ ุญุถุฑููุช) ูุงูููุงุฑุงุช ุงููุทููุจุฉ ููู ููุทูุฉ.

ุนูุฏ ุงุณุชูุงู ุณูุฑุฉ ุฐุงุชูุฉ ููุต ุงูููุดูุฑ ุงูุฐู ูุญุชูู ุนูู ุงููุธููุฉุ ููุฐ ูุง ููู ุจุตุฑุงูุฉ:
1. ุงูุชุญููู ุงูุนููู (Gap Analysis): ูุงุฑู ุงููููุงุช ุงูููุชุงุญูุฉ ูู ุงููุธููุฉ ุจูุง ูู ููุฌูุฏ ูู ุงูุณูุฑุฉ. ุญุฏุฏ ูุณุจุฉ ุงููุทุงุจูุฉ (%) ุจุดูู ุชูุฏูุฑู.
2. ููุฏ ุงูุณูุฑุฉ (Resume Audit): ุฃุฎุจุฑ ุงููุชุงุจุน ุนู ุฃุฎุทุงุก ุงูุชูุณููุ ุฃู ุฅุฐุง ูุงูุช ุงูุณูุฑุฉ ุทูููุฉ ุฌุฏุงูุ ุฃู ุฅุฐุง ูุงูุช ุชูุชูุฑ ูุจูุงูุงุช ุงูุงุชุตุงู ุงูุตุญูุญุฉ.
3. ุงูุชุฎุตูุต (Tailoring): ุงูุชุฑุญ ุนููู ุฌููุงู ูุญุฏุฏุฉ ููุชุจูุง ูู ูุณู "ุงููุฏู ุงููููู" ุฃู "ุงูุฎุจุฑุงุช" ูุชูุงุณุจ ูุฐู ุงููุธููุฉ ุญุตุฑุงู.
4. ุฎุงุฑุทุฉ ุงูุทุฑูู (Skill Path): ุฅุฐุง ูุงูุช ุงููุธููุฉ ุชุทูุจ ููุงุฑุงุช ูุง ูููููุงุ ุงูุชุฑุญ ุนููู ููุงุฑุฏ ูุญุฏุฏุฉ (ูุซู ููุงุฉ ูุตูุฉ ุฃู ุฏูุฑุงุช PMP).

ุงุณุชุฎุฏู ููุฌุฉ ููููุฉ ููููุฉ ุจูุถุงุก (ูุตุญู ูุจุณุทุฉ ูููููุง ุงูุฌููุน).
ูู ูุดุฌุนุงู ุฌุฏุงู (ูุซูุงู: "ุฎุทูุฉ ููุชุงุฒุฉ ูุง ุจุทู"ุ "ุณูุฑุชู ูุงุนุฏุฉ ูุชุญุชุงุฌ ููุณุงุช ุจุณูุทุฉ"). ุงุณุชุฎุฏู ุนุจุงุฑุงุช ุชุญููุฒูุฉ ูุชููุนุฉ ููุง ุชูุฑุฑูุง ูุซูุฑุงู.
ุงุณุชุฎุฏู ุงูุฑููุฒ ุงูุชุนุจูุฑูุฉ (Emojis) ุงููุฑุชุจุทุฉ ุจุงูุนูู ูุงููุฌุงุญ ๐ผ๐โจ.`;

export async function chatWithGemini(message: string, history: any[] = []) {
  const chat = ai.chats.create({
    model: "gemini-2.5-flash-lite", // Fast responses for general chat
    config: {
      systemInstruction: SYSTEM_INSTRUCTION,
    },
    history: history,
  });

  const response = await chat.sendMessage({ message });
  return response.text;
}

export async function analyzeResume(fileBase64: string, mimeType: string, jobDescription: string) {
  const response = await ai.models.generateContent({
    model: "gemini-3.1-pro-preview", // High quality for analysis
    contents: {
      parts: [
        {
          inlineData: {
            data: fileBase64.split(',')[1] || fileBase64,
            mimeType: mimeType,
          },
        },
        {
          text: `ูุฐู ูู ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ ุงููุฑููุฉ. ููุฐุง ูู ูุตู ุงููุธููุฉ ุงููุณุชูุฏูุฉ:
          
          ${jobDescription}
          
          ุงูุฑุฌุงุก ุงูููุงู ุจุงูุชุญููู ุงูุนูููุ ููุฏ ุงูุณูุฑุฉุ ุงูุชุฑุงุญุงุช ุงูุชุฎุตูุตุ ูุฎุงุฑุทุฉ ุงูุทุฑูู ููุง ูู ููุถุญ ูู ุชุนูููุงุช ุงููุธุงู.`,
        },
      ],
    },
    config: {
      systemInstruction: SYSTEM_INSTRUCTION,
    },
  });

  return response.text;
}
